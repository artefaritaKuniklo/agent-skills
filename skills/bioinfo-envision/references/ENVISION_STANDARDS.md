# 数据分析部门项目分析标准 v5.0

> 数据分析部 2025年11月

## 分析人员须知
- 项目责任制：项目分配后，由分析人员全权负责直到项目结题，确保结果专业准确、周期正常、结果可复现。
- 在责任制落实过程中遇到问题，分析人员应主动解决（例如：检索资料、寻求同事帮助、修改分析方案等）。

---

## 一、各个分析点的标准要求

### 1. 数据下载
- 不建议使用 GEO 中经 NCBI 官网定量后的数据；若使用需核对样本信息（样本信息不符视为需重分析）。
- 注释文件若已给出基因 symbol（列名可能不同），禁止再用 `bitr` 或类似方法自行转换基因 symbol。
- 必要时可做基因 symbol 转换，但不能用探针 ID 做差异分析。使用正确的注释版本（例如 TCGA 使用 Gencode v36）。
- 预后项目中避免重复的患者样本（例如 TCGA-DD-A114-01A 与 TCGA-DD-A114-01B 为重复样本）。
- 训练集、验证集与单细胞数据集的疾病定义、取样人群与组织类型应尽量保持一致。
- 对方向基因进行确认，注意有时方向基因由两个基因连在一起。

### 2. 差异分析
- 软件推荐：Count 数据使用 `DESeq2`；芯片数据使用 `limma`。
- 阈值筛选：优先使用 `padj`；最低标准为 `pvalue < 0.05` 且 `|logFC| > 0.5`。
  - 若采用更宽松的阈值（仅 pvalue、仅 padj 或降低 logFC）需申请，提供参考文献并与客户确认。
  - 差异基因数量过少（<100）需反馈主管；若差异基因过多且无法做 PPI，可适当提高 logFC（需有参考文献）。
- 注意事项：
  - 提前绘制 PCA 与箱线图检查看是否存在批次或离群样本；后续也需观察热图表现；
  - 禁止把不同平台的数据随意合并再去去批次（若需合并须在方案中明确并且同平台）；
  - 分组文件与表达矩阵的样本排序必须一致。
- 分组顺序：
  - 在 `DESeq2` 中可通过 `results` 的首行查看分组顺序；
  - 在 `limma` 中 `make.contrasts` 的 +1 为 Case、-1 为 Control（Case vs Control）。
- 数据使用说明：
  - FPKM、TPM、标准化后的 count 不可用于差异分析；`log2(count+1)` 不得用于任何分析；
  - `log2(fpkm+1)` 或 `log2(tpm+1)` 可用于差异分析以外的其他分析；
  - 同一高通量数据集同时存在 raw counts 与 FPKM/TPM 时，差异分析必须使用 raw counts，其他分析统一使用 FPKM/TPM（不可混用）；
  - 如果没有提供 count 数据，该数据集不能用作训练集或差异分析；
  - 检查 FPKM/TPM 是否已经标准化（可用 `range` 判断，标准化数据通常不超过 50）。

### 3. WGCNA
- 样本数至少 15（不区分组别，例如 5 vs 10 也可）。
- 若用评分或免疫浸润丰度作为性状：
  - 诊断类项目：评分/丰度在疾病 vs 对照组间差异显著；
  - 预后类项目：评分/丰度在肿瘤样本中 KM 显著。
- 报告须注明使用的样本类型（全部样本或仅疾病样本）。
- 输入矩阵需为标准化表达矩阵（高通量使用 TPM/FPKM，注意是否经过 log2 处理）；
- 剔除低表达或不表达基因；
- 软阈值筛选建议使 R^2 >= 0.8（最低 0.8，推荐 0.85–0.9），同时平均连接度应低于 200，选择第一个满足两项的软阈值；
- 模块筛选最低要求：模块与特征的相关系数 |r| > 0.3 且 p < 0.05。优先选择 |r| 最大的模块（灰色模块无意义）；相关性使用 Pearson。
- MM 与 GS 阈值建议：GS > 0.2、MM > 0.8（参考 PMID: 36311726），其他阈值需提供文献支持；
- 基因表达矩阵应包含所有基因（错误示例：仅使用差异基因）；
- 模块数量应适中，可通过调整聚类参数优化。

### 4. 第三方基因集评分（如 ssGSEA）
- 明确样本类型（全部样本或仅疾病样本）。
- 推荐方法优先选择 `ssGSEA`。
- 方向基因用于评分时，基因数应在 10–200 之间；`ssGSEA` 最低 10 个基因，30 个以上较好。
- 关键指标：预后项目关注评分在疾病样本中的生存差异；诊断项目关注评分在疾病与正常组间的差异。

### 5. 基因/蛋白网络构建
#### PPI
- 基因数量：最少 10 个，最多不超过 2000 个；
- 尽量不要单独用 PPI 来筛选关键基因；建议结合 Cytoscape 的 cytoHubba 插件使用多种算法联合筛选，并保存每种算法的结果与可视化（.pdf）；
- 避免并列情况（例如第 10 与第 11 基因得分相同），必要时调整算法或改变 Top 值，保存算法下全部基因结果表供审核；
- 孤立靶点：若仅展示互作则保留，若用于筛选则可去掉；
- PPI 的用途需明确（展示关系或缩小基因数目），由下游分析决定，不确定时咨询主管；
- STRING 筛选的置信度阈值需在报告中说明；
- 在 Cytoscape 美化后保存当前环境（`.cys`）；
- 若 PPI 基因数较多，可选择按 degree 排序的 Top 30 进行展示。

#### GeneMANIA
- 输入基因不宜过多，建议 10 个以下；
- 网络图上区分输入基因与非输入基因展示；
- 图中应展示疾病相关的生物学过程。

### 6. 单基因 ROC 分析
- 诊断 ROC 中 AUC > 0.7 且不能等于 1（AUC=1 不得用于筛选）；
- 样本量应足够（建议至少 8 vs 8），样本过少需申请；
- 图中线条颜色与标签需清晰、字体不宜过小；
- 训练集中单基因 AUC 需达到阈值（0.7），若基因过多可提高阈值（如 0.8、0.9）以减少基因数目。

### 7. 单基因表达分析
- 要求表达趋势一致且具有统计学显著性；
- 至少 2 个外部验证通过；
- 关键基因数量：诊断类最多 5 个（需外部验证），预后类最多 8 个；
- 验证集缺失基因最多 1 个，超过需调整或更换验证集；
- 当 count 与 FPKM 的趋势不一致时，可先对 count 做 VST 标准化并使用秩和检验，其他分析点需统一使用 VST 标准化数据（若采用 VST）。

### 8. 诊断模型 ROC
- 模型 ROC 需 AUC > 0.7，且模型 AUC 应大于单基因 AUC（若不满足可去掉相关单基因 ROC）；
- 模型与基因的 AUC 不得为 1，若出现可使用混淆矩阵、PR 曲线或 C-index 替代；
- 样本量建议至少 8 vs 8；
- 图示应标注最佳截断值与 95% 置信区间，线条颜色建议深色，标签字体适中。

### 9. 机器学习
- 样本量建议至少 8 vs 8；
- 交叉验证折数基于样本量：小样本（十几例）建议 3 折，其他可用 5 折或 10 折，每折样本数不得少于 3；
- 建议优先采用自限性方法并取交集，与非自限性方法取交集以提高稳健性；
- 分组因子水平：正常对照 = 0，疾病 = 1；
- 机器学习的目的可为：筛选基因、输出重要度或仅构建分类模型（无变量重要度）；
- 算法注意事项：
  - SVM-RFE、Lasso（alpha=1）、XGBoost、Boruta 等可用于基因筛选；
  - RF、GBM、XGBoost 等可输出变量重要度；
  - 模型误差不得为 0，精确度不得为 1（出现需检查过拟合）。
- 若输入给 ML 的基因数等于输出基因数，应更换算法或调整流程。

### 10. 预后模型
- 概念区分：预后风险模型（仅基因）与独立预后模型（riskScore + 临床特征）。
- 单因素 Cox：在单因素检验前需做 PH 假定检验（PH.p > 0.05）；首选 p < 0.05，最大可到 0.2（若 P < 0.2 需调整置信区间）；
- 构建方法：Lasso-Cox、 多因素 Cox（先做 PH 假定检验）、逐步回归、CoxBoost、randomForestSRC 等；
- 多因素模型中基因 p 值可不小于 0.05，但 PH 检验需全部 > 0.05；逐步回归需在模型已基本确定且为最优时使用；
- 独立预后模型必须包含 riskScore 与至少 1 个临床特征（若只有 riskScore 不构建列线图）；
- 列线图构建与评估：AUC > 0.6，且需至少另一个评估指标通过（例如校准曲线 p > 0.05 或 DCA 显示模型优于单变量）。
- 预后 ROC 年份要求：训练集与验证集（年份一致）AUC 均 > 0.6；若使用非常规年份需提供参考文献。
- 保证训练集与验证集的生存类型与单位一致（OS/PFS/DFS，年/月/天）。

### 11. GSEA / 12. GSVA / 13. 富集分析
- 若使用 `clusterProfiler`，注意随机性，可设置 `seed` 参数以复现结果；
- 背景基因集优先使用 KEGG；
- 单基因 GSEA 可用排序依据：LogFC 或基因相关性；单基因 GSEA 建议与 GSVA 结果对照；
- GSEA 阈值：|NES| > 1 且 p < 0.05（adjust.P < 0.05）；
- GSVA 阈值：|t| > 1（最低可为 0）且 p < 0.05（adjust.P < 0.05），差异分析用 `limma`；
- 富集分析优先考虑校准后的 P 值；用于富集的基因数不得少于 10（若 < 10，改为单基因 GSEA）。

### 14. 分子对接
- 说明化合物选择理由与结合能（参考阈值：-1.2 kcal/mol 或 -5 kJ/mol）；
- 图示包括一张整体图和一张局部放大图；
- 说明蛋白来源或 PDB ID；结构显示形式基于结构完整性（例如仅螺旋链时用棍棒形式）。

### 15. ceRNA / TF-miRNA-mRNA 网络
- 需使用多数据库预测结果的关系对交集（不能仅取靶点交集）；
- 正文需描述节点数和关系对数等信息。

### 16. 免疫治疗与 17. 免疫浸润
- 免疫治疗相关可使用 TIDE、IPS 等工具；
- 免疫浸润可采用多种算法（CIBERSORT、ssGSEA、xCell、TIMER 等；小鼠可用 CIBERSORT、ssGSEA）；
- 可使用 `immunedeconv` 包；注意细胞名称更新并按最新版本标注。

### 18. 聚类（一致性聚类 / NMF）
- 样本数最小建议 30；
- 一致性聚类评估：CDF 曲线、平台期的 K 值、热图；
- NMF 评估：热图与折线图中斜率下降最快的前一点；
- 关键指标：预后项目需类间生存差异；非预后项目需类间具有临床或功能意义（如通路评分或 GSVA 差异）。

### 19–34. 其他要点（摘要）
- 药物敏感性预测：对大量药物可与 riskScore 相关性高的药物绘制箱线图展示；
- 相关性系数最低阈值建议 0.3，选择 Pearson 或 Spearman 需根据数据分布（不确定时不建议用 Pearson）；
- MR 分析：OR 与基因上下调不必一致，但 MR 的 OR 与单因素 Cox 的 HR（若基因为暴露因素）应一致；留一法检验结果不可跨线；
- 单细胞质控需满足细胞数、基因数和线粒体占比三项要求，阈值须有文献支持；
- 异常值（极端 OR、HR、CI）可判定为异常并去除，可能源于低表达基因，建议在原始数据阶段过滤低表达基因；
- hdWGCNA：性状可用细胞或方向基因集评分；关键细胞可用 AUCell 评分筛选；
- 单基因项目：疾病对照间基因需有表达差异且趋势与主流文献一致；
- 单细胞分析注意：marker 基因不能仅来源于 findAllMarkers 的 top 特征，单一细胞类型 marker 数量尽量>1；报告应补充细胞类型—marker 基因—簇列表与未注释前 cluster 的 marker 气泡图；关键基因应在关键细胞中高表达并有时序差异；
- 单细胞受配体分析：复合蛋白需拆分，明确分析样本范围（疾病样本或全部样本）与分析对象（全部细胞间或仅关键细胞间），使用默认通讯概率阈值 p < 0.05（不足时需文献支持并向主管申请）；
- 方向基因扩充：药物或疾病靶基因不得用于扩充；药靶与疾病靶点优先取多数据库交集。

---

## 特殊情况注意要点
1. 急性髓系白血病：TCGA 取样为外周血，GEO 大部分为骨髓，故可用 GEO 骨髓数据集作为验证；
2. 预后分析（部分癌种）：宫颈癌、甲状腺癌、子宫内膜癌可申请不用外部验证集，采用 7:3 + 整体验证；其他癌种仍需外部验证集；
3. 预后 ROC 绘制须确保生存时间样本充足（例如不能画 7 年 ROC 若 7 年样本不足）；
4. 某些数据集同源，禁止在同一研究中将其分别作为训练集与验证集（示例：GSE108113 与 GSE200828 等）。

---

*来源：原始 PDF 文档已合并并经结构化整理（保留原文内容，去除分页与重复）。
